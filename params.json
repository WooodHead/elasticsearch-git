{"name":"Elasticsearch-git","tagline":"Elasticsearch integrations for git repositories. Provide index repository and full-text search code or commits in repository.","body":"# Elasticsearch::Git\r\n\r\n[Elasticsearch](https://github.com/elasticsearch/elasticsearch-rails/tree/master/elasticsearch-model) integrations for git repositories.\r\n\r\n## NOTE\r\n\r\nNow indexing text-like documents mo nore 1 mb size\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n``` ruby\r\ngem 'elasticsearch-git', '~> 0.0.4'\r\n\r\n# or\r\n\r\ngem 'elasticsearch-git', github: 'zzet/elasticsearch-git', ref: 'last_ref'\r\n```\r\n\r\nAnd then execute:\r\n\r\n``` bash\r\n$ bundle\r\n```\r\n\r\nOr install it yourself as:\r\n\r\n``` bash\r\n$ gem install elasticsearch-git\r\n```\r\n\r\n## Usage\r\n\r\n``` ruby\r\nclass Repository\r\n  include Elasticsearch::Git::Repository\r\n\r\n  def repository_id\r\n    project.id\r\n  end\r\n\r\n  repository_for_indexing '/path/to/your/repo'\r\nend\r\n\r\nRepository.__elasticsearch__.create_index! force: true\r\n\r\nrepo = Repository.new\r\nrepo.index_commits\r\nrepo.index_blobs\r\n\r\nrepo.index_commits(from_rev: \"1802bafa70d3b1678cfa46a482fd396dd8a4bd40\", to_rev: \"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\")\r\nrepo.index_blobs(from_rev: \"1802bafa70d3b1678cfa46a482fd396dd8a4bd40\", to_rev: \"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\")\r\n\r\nRepository.search(\"query\", type: 'blob')\r\nRepository.search(\"query\", type: 'commit')\r\n\r\n# Search in all types\r\nRepository.search(\"query\")\r\n```\r\n\r\n## Integration with Gitlab\r\n\r\n[Sample (In Undev Gitlab fork)](https://github.com/zzet/gitlabhq/blob/master/app/elastic/repositories_search.rb)\r\n\r\n``` ruby\r\n# app/elastic/repositories_search.rb\r\nmodule RepositoriesSearch\r\n  extend ActiveSupport::Concern\r\n\r\n  included do\r\n    include Elasticsearch::Git::Repository\r\n\r\n    self.__elasticsearch__.client = Elasticsearch::Client.new host: Gitlab.config.elasticsearch.host, port: Gitlab.config.elasticsearch.port\r\n\r\n    def repository_id\r\n      project.id\r\n    end\r\n  end\r\n\r\n  module ClassMethods\r\n    def import\r\n      Repository.__elasticsearch__.create_index! force: true\r\n\r\n      Project.find_each do |project|\r\n        if project.repository.exists? && !project.repository.empty?\r\n          project.repository.index_commits\r\n          project.repository.index_blobs\r\n        end\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\n# app/models/repository.rb\r\nclass Repository\r\n  include RepositoriesSearch\r\n  #...\r\n  def project\r\n    @project ||= Project.find_with_namespace(@path_with_namespace)\r\n  end\r\n  #...\r\nend\r\n\r\nRepository.import # for indexing all repositories\r\n\r\nRepository.__elasticsearch__.create_index! force: true\r\nProject.last.repository.index_commits\r\nProject.last.repository.index_blobs\r\n\r\nRepository.search(\"some_query\")\r\n# => {blobs: [{}, {}, {}], commits: [{}, {}, {}]}\r\n\r\nRepository.search(\"some_query\", type: :blob)\r\n# => {blobs: [{}, {}, {}], commits: []}\r\n\r\nRepository.search(\"some_query\", type: :commit)\r\n# => {blobs: [], commits: [{}, {}, {}]}\r\n\r\nRepository.search(\"some_query\", type: :commit, page: 2, per: 50)\r\n# => ...\r\n\r\nRepository.search(\"some_query\", options: { repository_id: Project.last.id })\r\n# => {blobs: [{}, {}, {}], commits: [{}, {}, {}]}\r\n\r\nRepository.search(\"some_query\", options: { repository_id: current_user.authorized_projects.ids })\r\n# => {blobs: [{}, {}, {}], commits: [{}, {}, {}]}\r\n\r\nProject.last.repository.search(\"Copyright\")[:blobs].first\r\n=> #<Elasticsearch::Model::Response::Result:0xbb84b3fc\r\n @result=\r\n  {\"_index\"=>\"repository-index-development\",\r\n   \"_type\"=>\"repository\",\r\n   \"_id\"=>\"4328_LICENSE.txt\",\r\n   \"_score\"=>0.034848917,\r\n   \"_source\"=>\r\n    {\"blob\"=>\r\n      {\"type\"=>\"blob\",\r\n       \"oid\"=>\"f99909cd4ecb6f2ad08f8e55aac3a9fcd86a2bd2\",\r\n       \"rid\"=>4328,\r\n       \"content\"=>\r\n        \"Copyright (c) 2014 Andrey Kumanyaev\\n\\nMIT\r\nLicense\\n\\nPermission is hereby granted, free of charge, to any person\r\nobtaining\\na copy of this software and associated documentation files\r\n(the\\n\\\"Software\\\"), to deal in the Software without restriction,\r\nincluding\\nwithout limitation the rights to use, copy, modify, merge,\r\npublish,\\ndistribute, sublicense, and/or sell copies of the Software,\r\nand to\\npermit persons to whom the Software is furnished to do so,\r\nsubject to\\nthe following conditions:\\n\\nThe above copyright notice and\r\nthis permission notice shall be\\nincluded in all copies or substantial\r\nportions of the Software.\\n\\nTHE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT\r\nWARRANTY OF ANY KIND,\\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO\r\nTHE WARRANTIES OF\\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE\r\nAND\\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS\r\nBE\\nLIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\r\nACTION\\nOF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\r\nCONNECTION\\nWITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\\n\",\r\n       \"commit_sha\"=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"}}}>\r\n```\r\n\r\n## Examples\r\n\r\nAfter integration this gem into [Gitlab](https://github.com/gitlabhq/gitlabhq)\r\n\r\n``` ruby\r\nRepository.search(\"too\")[:commits].first\r\n=> #<Elasticsearch::Model::Response::Result:0xbb50dfdc\r\n @result=\r\n  {\"_index\"=>\"repository-index-development\",\r\n   \"_type\"=>\"repository\",\r\n   \"_id\"=>\"4328_1802bafa70d3b1678cfa46a482fd396dd8a4bd40\",\r\n   \"_score\"=>0.15873253,\r\n   \"_source\"=>\r\n    {\"commit\"=>\r\n      {\"type\"=>\"commit\",\r\n       \"rid\"=>4328,\r\n       \"sha\"=>\"1802bafa70d3b1678cfa46a482fd396dd8a4bd40\",\r\n       \"author\"=>\r\n        {\"name\"=>\"Andrey Kumanyaev\",\r\n         \"email\"=>\"me@zzet.org\",\r\n         \"time\"=>\"2014-02-16T02:24:23+04:00\"},\r\n       \"committer\"=>\r\n        {\"name\"=>\"Andrey Kumanyaev\",\r\n         \"email\"=>\"me@zzet.org\",\r\n         \"time\"=>\"2014-02-16T02:24:23+04:00\"},\r\n       \"message\"=>\"Save 2. Indexing work. Search too\\n\"}}}>\r\n\r\n\r\nProject.last.repository.as_indexed_json\r\n  Project Load (1.7ms)  SELECT \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" DESC LIMIT 1\r\n  Namespace Load (4.8ms)  SELECT \"namespaces\".* FROM \"namespaces\" WHERE \"namespaces\".\"id\" = $1 ORDER BY \"namespaces\".\"id\" ASC LIMIT 1  [[\"id\", 3739]]\r\n  Namespace Load (0.9ms)  SELECT \"namespaces\".* FROM \"namespaces\" WHERE \"namespaces\".\"path\" = 'zzet' LIMIT 1\r\n  Project Load (0.7ms)  SELECT \"projects\".* FROM \"projects\" WHERE \"projects\".\"namespace_id\" = 3739 AND \"projects\".\"path\" = 'elasticsearch-git' LIMIT 1\r\n# Long lines are stripped manually\r\n=> {:blobs=>\r\n  [[{:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_.gitignore\",\r\n     :rid=>4328,\r\n     :oid=>\"d87d4be66f458acd52878902bbf1391732ad21e1\",\r\n     :content=>\r\n      \"*.gem\\n*.rbc\\n.bundle\\n.config\\n.yardoc\\nGemfile.lock\\nInstalledFiles\\n_yardoc\\ncoverage\\ndoc/\\nlib/bundler/man\\npkg\\nrdoc\\nspec/reports\\ntest/tmp\\ntest/version_tmp\\ntmp\\n\",\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_Gemfile\",\r\n     :rid=>4328,\r\n     :oid=>\"7322405f8f3ee5de24f7a727940ac52543e8954c\",\r\n     :content=>\r\n      \"source 'https://rubygems.org'\\n\\n# Specify your gem's dependencies in elasticsearch-git.gemspec\\ngemspec\\n\\ngem 'elasticsearch-model', github: 'elasticsearch/elasticsearch-rails'\\ngem 'elasticsearc.....\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_LICENSE.txt\",\r\n     :rid=>4328,\r\n     :oid=>\"f99909cd4ecb6f2ad08f8e55aac3a9fcd86a2bd2\",\r\n     :content=>\r\n      \"Copyright (c) 2014 Andrey Kumanyaev\\n\\nMIT License\\n\\nPermission is hereby granted, free of charge, to any person obtaining\\na copy of this software and associated documentation files (the\\n\\\"Softw....\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_README.md\",\r\n     :rid=>4328,\r\n     :oid=>\"8258d574dfc8040a5d003f06c6493e0033527f36\",\r\n     :content=>\r\n      \"# Elasticsearch::Git\\n\\nAttention: Pre-pre-pre beta code. Not production.\\n\\n[Elasticsearch](https://github.com/elasticsearch/elasticsearch-rails/tree/master/elasticsearch-model) integrations for g....\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_Rakefile\",\r\n     :rid=>4328,\r\n     :oid=>\"29955274e0d42e164337c411ad9144e8ffd7e46e\",\r\n     :content=>\"require \\\"bundler/gem_tasks\\\"\\n\",\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_elasticsearch-git.gemspec\",\r\n     :rid=>4328,\r\n     :oid=>\"67762437568dda1bb98ec5eca8be7e4a5c8115a9\",\r\n     :content=>\r\n      \"# coding: utf-8\\nlib = File.expand_path('../lib', __FILE__)\\n$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)\\nrequire 'elasticsearch/git/version'\\n\\nGem::Specification.new do |spec|\\n  spec...\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_elasticsearch/git.rb\",\r\n     :rid=>4328,\r\n     :oid=>\"d3817ec58af1f44dfd18856bf54ef2bf607901a8\",\r\n     :content=>\r\n      \"require \\\"elasticsearch/git/version\\\"\\nrequire \\\"elasticsearch/git/model\\\"\\nrequire \\\"elasticsearch/git/commit\\\"\\n\\nmodule Elasticsearch\\n  module Git\\n    class Test\\n      include Elasticsearch::...\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_git/model.rb\",\r\n     :rid=>4328,\r\n     :oid=>\"3dfbae747f25391779fbe012fe8cc4f38cc4651c\",\r\n     :content=>\r\n      \"require 'active_support/concern'\\nrequire 'active_model'\\nrequire 'elasticsearch/model'\\n\\nmodule Elasticsearch\\n  module Git\\n    module Model\\n      extend ActiveSupport::Concern\\n\\n      include...\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_git/repository.rb\",\r\n     :rid=>4328,\r\n     :oid=>\"70fe59c8391f6c27adb79c3e45824e6b4cf9566c\",\r\n     :content=>\r\n      \"require 'active_support/concern'\\nrequire 'active_model'\\nrequire 'elasticsearch'\\nrequire 'elasticsearch/model'\\nrequire 'rugged'\\nrequire 'gitlab_git'\\n\\nmodule Elasticsearch\\n  module Git\\n    m...\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_git/version.rb\",\r\n     :rid=>4328,\r\n     :oid=>\"79e8082b122492464732f1fb43e9f2bdc96ea146\",\r\n     :content=>\r\n      \"module Elasticsearch\\n  module Git\\n    VERSION = \\\"0.0.1\\\"\\n  end\\nend\\n\",\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"},\r\n    {:type=>\"blob\",\r\n     :id=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28_test/test_helper.rb\",\r\n     :rid=>4328,\r\n     :oid=>\"6acc0d2b7bf0f286557d3757c1140b41ab57e8f7\",\r\n     :content=>\r\n      \"require \\\"rubygems\\\"\\nrequire 'bundler/setup'\\nrequire 'pry'\\n\\nBundler.require\\n\\nrequire 'wrong/adapters/minitest'\\n\\nPROJECT_ROOT = File.join(Dir.pwd)\\n\\nWrong.config.color\\n\\nMinitest.autorun\\n...\"\r\n     :commit_sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\"}]],\r\n :commits=>\r\n  [{:type=>\"commit\",\r\n    :sha=>\"8d4175e9f4a36065b52fa752c1fd3594c82c0f28\",\r\n    :author=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 13:50:32 +0400},\r\n    :committer=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 13:50:32 +0400},\r\n    :message=>\"Improve readme\\n\"},\r\n   {:type=>\"commit\",\r\n    :sha=>\"37f1b0710eb7f41254ae0c33db09794a25bbb246\",\r\n    :author=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 13:49:25 +0400},\r\n    :committer=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 13:49:25 +0400},\r\n    :message=>\"prepare first test release\\n\"},\r\n   {:type=>\"commit\",\r\n    :sha=>\"1802bafa70d3b1678cfa46a482fd396dd8a4bd40\",\r\n    :author=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 02:24:23 +0400},\r\n    :committer=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 02:24:23 +0400},\r\n    :message=>\"Save 2. Indexing work. Search too\\n\"},\r\n   {:type=>\"commit\",\r\n    :sha=>\"3ed383bfbf6cba611d191dbc3590779c0444b7f0\",\r\n    :author=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 00:23:10 +0400},\r\n    :committer=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-16 00:23:10 +0400},\r\n    :message=>\"Save commit\\n\"},\r\n   {:type=>\"commit\",\r\n    :sha=>\"7021addf520a19bdeceef29947c8687965c132ff\",\r\n    :author=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-15 14:28:43 +0400},\r\n    :committer=>\r\n     {:name=>\"Andrey Kumanyaev\",\r\n      :email=>\"me@zzet.org\",\r\n      :time=>2014-02-15 14:28:43 +0400},\r\n    :message=>\"first commit\\n\"}]}\r\n```\r\n\r\n## TODO\r\n\r\n    * Add Exceptions handlers for indexing (Error connections and timeouts)\r\n\r\n## Contributing\r\n\r\n1. Fork it ( http://github.com/[my-github-username]/elasticsearch-git/fork )\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Add some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}